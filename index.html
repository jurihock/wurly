<html>
<head>

	<title>wurly</title>

	<link rel="stylesheet" href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css">

	<script type="text/javascript">

		function grind(input, output)
		{
			var value = input.value.trim();

			output.value = '';

			if (!value)
			{
				return;
			}

			try
			{
				var url = new URL(value);
				var params = new URLSearchParams(url.search);

				params.sort();

				var pad = Math.max(...([...params.keys()].map(key => key.length)));

				pad = isFinite(pad) ? pad : 0;

				var lines = [];

				for(var entry of params.entries())
				{
					lines.push(entry[0].padEnd(pad) + '\t' + entry[1]); 
				}

				output.value = lines.join('\n');
			}
			catch(error)
			{
				console.error(error);
			}
        }

		function highlight(output)
		{
			var caret = output.selectionStart;
			var value = output.value;
			var roi = value.substr(0, caret);

			var words = value.split('\t').join('\n').split('\n');
			var word = roi.split('\t').join('\n').split('\n').length - 1;

			var start = 0;
			var end = 0;

			for (var i = 0; i < word; i++)
			{
				start += words[i].length + 1;
			}

			end = start + words[word].trim().length;

			output.selectionStart = start;
			output.selectionEnd = end;
		}

	</script>

</head>
<body class="p-0 m-0 bg-white text-black">

	<div class="container mx-auto">
		<div class="grid grid-flow-row auto-rows-max">
			<div class="my-3 text-xl font-medium">
				<label for="input">URL</label>
			</div>
			<div class="">
				<textarea autofocus id="input" rows="5" class="border rounded font-mono font-light p-1 w-full"></textarea>
			</div>
			<div class="my-3 text-xl font-medium">
				<label for="output">URL Search Params</label>
			</div>
			<div class="">
				<textarea readonly id="output" rows="20" class="border rounded bg-gray-50 font-mono font-light p-1 w-full"></textarea>
			</div>
		</div>
	</div>

	<script type="text/javascript">

		var input = document.getElementById('input');
		var output = document.getElementById('output');

		input.addEventListener('click', function()
		{
			input.select();
		});

		input.addEventListener('input', function()
		{
			grind(input, output);
		});

		output.addEventListener('click', function()
		{
			highlight(output);
		});

	</script>

</body>
</html>
